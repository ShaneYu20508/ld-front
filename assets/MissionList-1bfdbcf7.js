import{Y as J,x as r,a0 as F,a1 as O,c as t,a3 as s,aj as W,a5 as Y,ab as z,J as b,a8 as V,ag as G,ak as Q,V as X,a2 as Z,a4 as ee,a7 as y,af as ae,ae as te,al as le,ai as se,a9 as oe,ad as re,W as ie}from"./index-607a8a67.js";import{c as ne,a as A,f as D,e as ue,u as de,d as c,V as ce}from"./index.esm-d16b0be2.js";import{V as me}from"./VContainer-1c4cb086.js";import{V as pe,a as S}from"./VRow-e4f68762.js";import{V as ve}from"./VDivider-2912afba.js";import{V as fe}from"./VDataTableServer-71b0c260.js";import"./VDataTable-fa46f2c4.js";import"./VList-ed8f3875.js";import"./ssrBoot-8d294cb5.js";import"./VCheckboxBtn-0b874b0f.js";const ge=re("h1",{class:"text-center"},"任務管理",-1),_e={__name:"MissionList",setup(be){const{apiAuth:k}=z(),P=J(),I=r(null),m=r(!1),i=r(""),U=o=>{o?(i.value=o._id,T.value.value=o.title,E.value.value=o.reward,R.value.value=o.requiredPeople,K.value.value=o.isPublic,M.value.value=o.description):i.value="",m.value=!0},_=()=>{m.value=!1,N(),I.value.deleteFileRecord()},$=ne({title:A().required("請輸入任務標題"),reward:D().typeError("報酬格式錯誤").required("請輸入報酬").min(1,"報酬需大於 0"),requiredPeople:D().typeError("需求人數格式錯誤").required("請輸入需求人數").min(1,"需求人數需大於 0"),isPublic:ue(),description:A().required("請輸入任務內容")}),{handleSubmit:L,isSubmitting:h,resetForm:N}=de({validationSchema:$,initialValues:{title:"",reward:0,requiredPeople:"",isPublic:"",description:!1}}),T=c("title"),E=c("reward"),R=c("requiredPeople"),K=c("isPublic"),M=c("description"),p=r([]),j=L(async o=>{var a,e,d;if(!((a=p.value[0])!=null&&a.error)&&!(i.value===""&&p.value.length===0))try{const l=new FormData;for(const n in o)l.append(n,o[n]);p.value.length>0&&l.append("image",p.value[0].file),i.value===""?await k.post("/missions",l):await k.patch("/missions/"+i.value,l),P({text:i.value===""?"新增成功":"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),_(),B()}catch(l){console.log(l);const n=((d=(e=l==null?void 0:l.response)==null?void 0:e.data)==null?void 0:d.message)||"發生錯誤，請稍後再試";P({text:n,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),w=r(10),v=r([{key:"createdAt",order:"desc"}]),f=r(1),C=r([1]),H=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"任務標題",align:"left",sortable:!0,key:"title"},{title:"任務報酬/m",align:"left",sortable:!0,key:"reward"},{title:"任務狀態",align:"left",sortable:!0,key:"status"},{title:"任務說明",align:"left",sortable:!0,key:"description"},{title:"編輯",align:"left",sortable:!1,key:"edit"}],x=r(!0),q=r(0),g=r(""),u=async()=>{var o,a,e,d;x.value=!0;try{const{data:l}=await k.get("/missions/all",{params:{page:f.value,itemsPerPage:w.value,sortBy:((o=v.value[0])==null?void 0:o.key)||"createdAt",sortOrder:((a=v.value[0])==null?void 0:a.order)==="asc"?1:-1,search:g.value}});C.value.splice(0,C.value.length,...l.result.data),q.value=l.result.total}catch(l){console.log(l);const n=((d=(e=l==null?void 0:l.response)==null?void 0:e.data)==null?void 0:d.message)||"發生錯誤，請稍後再試";P({text:n,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}x.value=!1};u();const B=()=>{f.value=1,u()};return(o,a)=>(F(),O(Y,null,[t(me,null,{default:s(()=>[t(pe,null,{default:s(()=>[t(S,{cols:"12"},{default:s(()=>[ge]),_:1}),t(ve),t(S,{cols:"12"},{default:s(()=>[t(b,{color:"green",onClick:a[0]||(a[0]=e=>U())},{default:s(()=>[V("新增商品")]),_:1})]),_:1}),t(S,{cols:"12"},{default:s(()=>[t(fe,{"items-per-page":w.value,"onUpdate:itemsPerPage":[a[3]||(a[3]=e=>w.value=e),u],"sort-by":v.value,"onUpdate:sortBy":[a[4]||(a[4]=e=>v.value=e),u],page:f.value,"onUpdate:page":[a[5]||(a[5]=e=>f.value=e),u],items:C.value,headers:H,loading:x.value,"items-length":q.value,search:g.value,hover:""},{top:s(()=>[t(G,{label:"搜尋","append-icon":"mdi-magnify",modelValue:g.value,"onUpdate:modelValue":a[1]||(a[1]=e=>g.value=e),"onClick:append":B,onKeydown:Q(B,["enter"])},null,8,["modelValue"])]),"item.image":s(({item:e})=>[t(X,{src:e.image,height:"50px"},null,8,["src"])]),"item.sell":s(({item:e})=>[e.sell?(F(),Z(ie,{key:0,icon:"mdi-check"})):ee("",!0)]),"item.edit":s(({item:e})=>[t(b,{icon:"mdi-delete",variant:"text",color:"red",onClick:a[2]||(a[2]=()=>{})})]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),t(W,{modelValue:m.value,"onUpdate:modelValue":a[6]||(a[6]=e=>m.value=e),persistent:"",width:"500px"},{default:s(()=>[t(ce,{disabled:y(h),onSubmit:ae(y(j),["prevent"])},{default:s(()=>[t(te,null,{default:s(()=>[t(le,null,{default:s(()=>[V(" 確認刪除任務")]),_:1}),t(se,null,{default:s(()=>[t(oe),t(b,{color:"red",disabled:y(h),onClick:_},{default:s(()=>[V("取消")]),_:1},8,["disabled"]),t(b,{color:"green",type:"submit",loading:y(h)},{default:s(()=>[V("確認")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64))}};export{_e as default};
