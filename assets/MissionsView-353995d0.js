import{p as ne,g as ie,o as j,t as V,aw as de,q as me,u as ce,c as t,a5 as re,G as K,Y as ve,x as d,a0 as Z,a1 as pe,a3 as u,aj as ge,ab as be,J as N,a8 as L,ai as $,ax as fe,V as Ve,a2 as ye,a4 as Pe,a7 as r,ah as he,ag as ke,ak as we,aa as Se,al as xe,am as Te,a9 as De,af as Ce,W as Be}from"./index-5fdb30a4.js";import{c as Ie,a as ee,e as ae,f as qe,u as Fe,d as A,V as Ue}from"./index.esm-4c2e4fc2.js";import{V as Re}from"./VContainer-081fdd0a.js";import{V as Ae}from"./VRow-75030038.js";import{V as W}from"./VCol-8836c20f.js";import{V as Ee}from"./VDivider-9e522767.js";import{m as _e,a as Ge,b as Me,c as Ne,d as Le,e as $e,f as He,u as Oe,p as je,g as Ke,h as We,i as Je,j as Ye,k as ze,l as Qe,n as te,o as le,q as oe,r as se}from"./VDataTable-02535af6.js";import{V as Xe,a as Ze}from"./VTextarea-dfc9369f.js";import"./VList-02a1dc23.js";import"./ssrBoot-424ff488.js";import"./VCheckboxBtn-ce21a40e.js";const ea=ne({itemsLength:{type:[Number,String],required:!0},..._e(),...Ge(),...Me()},"VDataTableServer"),aa=ie()({name:"VDataTableServer",props:ea(),emits:{"update:modelValue":l=>!0,"update:page":l=>!0,"update:itemsPerPage":l=>!0,"update:sortBy":l=>!0,"update:options":l=>!0,"update:expanded":l=>!0,"update:groupBy":l=>!0},setup(l,T){let{attrs:D,slots:a}=T;const{groupBy:c}=Ne(l),{sortBy:i,multiSort:E,mustSort:_}=Le(l),{page:y,itemsPerPage:C}=$e(l),B=j(()=>parseInt(l.itemsLength,10)),{columns:G,headers:P}=He(l,{groupBy:c,showSelect:V(l,"showSelect"),showExpand:V(l,"showExpand")}),{items:v}=Oe(l,G),{toggleSort:g}=je({sortBy:i,multiSort:E,mustSort:_,page:y}),{opened:h,isGroupOpen:k,toggleGroup:w,extractRows:H}=Ke({groupBy:c,sortBy:i}),{pageCount:I,setItemsPerPage:S}=We({page:y,itemsPerPage:C,itemsLength:B}),{flatItems:b}=Je(v,c,h),{isSelected:q,select:O,selectAll:F,toggleSelect:M,someSelected:x,allSelected:f}=Ye(l,{allItems:v,currentPage:v}),{isExpanded:U,toggleExpand:n}=ze(l),o=j(()=>H(v.value));Qe({page:y,itemsPerPage:C,sortBy:i,groupBy:c,search:V(l,"search")}),de("v-data-table",{toggleSort:g,sortBy:i}),me({VDataTableRows:{hideNoData:V(l,"hideNoData"),noDataText:V(l,"noDataText"),loading:V(l,"loading"),loadingText:V(l,"loadingText")}});const e=j(()=>({page:y.value,itemsPerPage:C.value,sortBy:i.value,pageCount:I.value,toggleSort:g,setItemsPerPage:S,someSelected:x.value,allSelected:f.value,isSelected:q,select:O,selectAll:F,toggleSelect:M,isExpanded:U,toggleExpand:n,isGroupOpen:k,toggleGroup:w,items:o.value.map(m=>m.raw),internalItems:o.value,groupedItems:b.value,columns:G.value,headers:P.value}));ce(()=>{const m=te.filterProps(l),s=le.filterProps(l),p=oe.filterProps(l),ue=se.filterProps(l);return t(se,K({class:["v-data-table",{"v-data-table--loading":l.loading},l.class],style:l.style},ue),{top:()=>{var R;return(R=a.top)==null?void 0:R.call(a,e.value)},default:()=>{var R,J,Y,z,Q,X;return a.default?a.default(e.value):t(re,null,[(R=a.colgroup)==null?void 0:R.call(a,e.value),t("thead",{class:"v-data-table__thead",role:"rowgroup"},[t(le,K(s,{sticky:l.fixedHeader}),a)]),(J=a.thead)==null?void 0:J.call(a,e.value),t("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[(Y=a["body.prepend"])==null?void 0:Y.call(a,e.value),a.body?a.body(e.value):t(oe,K(D,p,{items:b.value}),a),(z=a["body.append"])==null?void 0:z.call(a,e.value)]),(Q=a.tbody)==null?void 0:Q.call(a,e.value),(X=a.tfoot)==null?void 0:X.call(a,e.value)])},bottom:()=>a.bottom?a.bottom(e.value):t(te,m,{prepend:a["footer.prepend"]})})})}}),ta=Ce("h1",{class:"text-center"},"商品管理",-1),pa={__name:"MissionsView",setup(l){const{apiAuth:T}=be(),D=ve(),a=d(null),c=d(!1),i=d(""),E=n=>{n?(i.value=n._id,P.value.value=n.title,v.value.value=n.reward,g.value.value=n.requiredPeople,h.value.value=n.isPublic,k.value.value=n.description):i.value="",c.value=!0},_=()=>{c.value=!1,G(),a.value.deleteFileRecord()},y=Ie({title:ee().required("請輸入任務標題"),reward:ae().typeError("報酬格式錯誤").required("請輸入報酬").min(1,"報酬需大於 0"),requiredPeople:ae().typeError("需求人數格式錯誤").required("請輸入需求人數").min(1,"需求人數需大於 0"),isPublic:qe(),description:ee().required("請輸入任務內容")}),{handleSubmit:C,isSubmitting:B,resetForm:G}=Fe({validationSchema:y,initialValues:{title:"",reward:0,requiredPeople:"",isPublic:"",description:!1}}),P=A("title"),v=A("reward"),g=A("requiredPeople"),h=A("isPublic"),k=A("description"),w=d([]),H=C(async n=>{var o,e,m;if(!((o=w.value[0])!=null&&o.error)&&!(i.value===""&&w.value.length===0))try{const s=new FormData;for(const p in n)s.append(p,n[p]);w.value.length>0&&s.append("image",w.value[0].file),i.value===""?await T.post("/missions",s):await T.patch("/missions/"+i.value,s),D({text:i.value===""?"新增成功":"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),_(),U()}catch(s){console.log(s);const p=((m=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:m.message)||"發生錯誤，請稍後再試";D({text:p,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),I=d(10),S=d([{key:"createdAt",order:"desc"}]),b=d(1),q=d([1]),O=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"名稱",align:"center",sortable:!0,key:"name"},{title:"價格",align:"center",sortable:!0,key:"price"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"是否上架",align:"center",sortable:!0,key:"sell"},{title:"編輯",align:"center",sortable:!1,key:"edit"}],F=d(!0),M=d(0),x=d(""),f=async()=>{var n,o,e,m;F.value=!0;try{const{data:s}=await T.get("/missions/all",{params:{page:b.value,itemsPerPage:I.value,sortBy:((n=S.value[0])==null?void 0:n.key)||"createdAt",sortOrder:((o=S.value[0])==null?void 0:o.order)==="asc"?1:-1,search:x.value}});q.value.splice(0,q.value.length,...s.result.data),M.value=s.result.total}catch(s){console.log(s);const p=((m=(e=s==null?void 0:s.response)==null?void 0:e.data)==null?void 0:m.message)||"發生錯誤，請稍後再試";D({text:p,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}F.value=!1};f();const U=()=>{b.value=1,f()};return(n,o)=>(Z(),pe(re,null,[t(Re,null,{default:u(()=>[t(Ae,null,{default:u(()=>[t(W,{cols:"12"},{default:u(()=>[ta]),_:1}),t(Ee),t(W,{cols:"12"},{default:u(()=>[t(N,{color:"green",onClick:o[0]||(o[0]=e=>E())},{default:u(()=>[L("新增商品")]),_:1})]),_:1}),t(W,{cols:"12"},{default:u(()=>[t(aa,{"items-per-page":I.value,"onUpdate:itemsPerPage":[o[2]||(o[2]=e=>I.value=e),f],"sort-by":S.value,"onUpdate:sortBy":[o[3]||(o[3]=e=>S.value=e),f],page:b.value,"onUpdate:page":[o[4]||(o[4]=e=>b.value=e),f],items:q.value,headers:O,loading:F.value,"items-length":M.value,search:x.value,hover:""},{top:u(()=>[t($,{label:"搜尋","append-icon":"mdi-magnify",modelValue:x.value,"onUpdate:modelValue":o[1]||(o[1]=e=>x.value=e),"onClick:append":U,onKeydown:fe(U,["enter"])},null,8,["modelValue"])]),"item.image":u(({item:e})=>[t(Ve,{src:e.image,height:"50px"},null,8,["src"])]),"item.sell":u(({item:e})=>[e.sell?(Z(),ye(Be,{key:0,icon:"mdi-check"})):Pe("",!0)]),"item.edit":u(({item:e})=>[t(N,{icon:"mdi-pencil",variant:"text",color:"gray",onClick:m=>E(e)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),t(ge,{modelValue:c.value,"onUpdate:modelValue":o[10]||(o[10]=e=>c.value=e),persistent:"",width:"500px"},{default:u(()=>[t(Ue,{disabled:r(B),onSubmit:he(r(H),["prevent"])},{default:u(()=>[t(ke,null,{default:u(()=>[t(we,null,{default:u(()=>[L(Se(i.value===""?"新增任務":"編輯任務"),1)]),_:1}),t(xe,null,{default:u(()=>[t($,{label:"任務標題",modelValue:r(P).value.value,"onUpdate:modelValue":o[5]||(o[5]=e=>r(P).value.value=e),"error-messages":r(P).errorMessage.value},null,8,["modelValue","error-messages"]),t($,{label:"報酬/m",type:"number",min:"1",modelValue:r(v).value.value,"onUpdate:modelValue":o[6]||(o[6]=e=>r(v).value.value=e),"error-messages":r(v).errorMessage.value},null,8,["modelValue","error-messages"]),t($,{label:"需求人數",type:"number",min:"1",modelValue:r(g).value.value,"onUpdate:modelValue":o[7]||(o[7]=e=>r(g).value.value=e),"error-messages":r(g).errorMessage.value},null,8,["modelValue","error-messages"]),t(Xe,{label:"私人",modelValue:r(h).value.value,"onUpdate:modelValue":o[8]||(o[8]=e=>r(h).value.value=e),"error-messages":r(h).errorMessage.value},null,8,["modelValue","error-messages"]),t(Ze,{label:"任務內容",modelValue:r(k).value.value,"onUpdate:modelValue":o[9]||(o[9]=e=>r(k).value.value=e),"error-messages":r(k).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),t(Te,null,{default:u(()=>[t(De),t(N,{color:"red",disabled:r(B),onClick:_},{default:u(()=>[L("取消")]),_:1},8,["disabled"]),t(N,{color:"green",type:"submit",loading:r(B)},{default:u(()=>[L("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64))}};export{pa as default};
