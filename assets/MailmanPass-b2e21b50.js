import{Y as W,x as u,$ as G,a0 as j,a2 as z,a3 as t,ab as Q,c as l,ag as p,ak as X,V as Z,W as ee,a4 as ae,J as I,aj as le,a7 as s,af as se,ae as te,al as oe,a8 as q,ah as re,ai as ue,a9 as ne,ad as ie}from"./index-7c4136cb.js";import{c as de,a as g,e as me,u as ce,d as m,V as ve}from"./index.esm-be031291.js";import{V as pe}from"./VContainer-10172ae1.js";import{a as U,V as K}from"./VRow-8cf118d2.js";import{V as ge}from"./VDataTableServer-94d74939.js";import{V as fe}from"./VCheckbox-c2a8591d.js";import{V as Ve}from"./VTextarea-5792824e.js";import"./VDataTable-59b18920.js";import"./VList-9c4057f2.js";import"./ssrBoot-a11e10f2.js";import"./VDivider-6ca50d70.js";import"./VCheckboxBtn-ebe4b3cd.js";const be=ie("h1",{class:"text-center"},"幹員管理",-1),_e={__name:"MailmanPass",setup(ke){const{apiAuth:B}=Q(),S=W(),D=u(null),c=u(""),f=u(!1),L=r=>{r?(c.value=r._id,V.value.value=r.account,b.value.value=r.code,k.value.value=r.email,y.value.value=r.skills,x.value.value=r.experience,w.value.value=r.pass):c.value="",f.value=!0},N=()=>{f.value=!1,Y(),D.value.deleteFileRecord()},O=de({account:g().required("請輸入帳號").min(4,"帳號長度不符").max(20,"帳號長度不符"),code:g().required("請輸入幹員代號").min(1,"幹員代號長度不符").max(20,"幹員代號長度不符"),email:g().required("信箱為必填欄位"),experience:g().required("請輸入工作經驗"),skills:g().required("請輸入幹員專長"),pass:me()}),{handleSubmit:E,isSubmitting:P,resetForm:Y}=ce({validationSchema:O,initialValues:{account:"",code:"",email:"",experience:"",skills:"",pass:!1}}),V=m("account"),b=m("code"),k=m("email"),x=m("experience"),y=m("skills"),w=m("pass"),n=u([]),R=u([]),H=E(async r=>{var a,i,e;if(!((a=n.value[0])!=null&&a.error)&&!(c.value===""&&n.value.length===0))try{const o=new FormData;for(const d in r)o.append(d,r[d]);n.value.length>0&&n.value.length>0&&n.value[0].file&&o.append("image",n.value[0].file),c.value===""?await B.post("/mailmans",o):await B.patch("/mailmans/"+c.value,o),S({text:"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),N(),T()}catch(o){console.log(o);const d=((e=(i=o==null?void 0:o.response)==null?void 0:i.data)==null?void 0:e.message)||"發生錯誤，請稍後再試";S({text:d,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),A=u(10),C=u([{key:"createAt",order:"asc"}]),h=u(1),F=u([]),J=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"代號",align:"center",sortable:!0,key:"code"},{title:"專長",align:"center",sortable:!1,key:"skills"},{title:"審核",align:"center",sortable:!0,key:"pass"},{title:"編輯",align:"center",sortable:!1,key:"edit"}],_=u(!0),$=u(0),M=u(""),v=async()=>{var r,a,i,e;_.value=!0;try{const{data:o}=await B.get("/mailmans/all",{headers:{Authorization:"Bearer YOUR_ACCESS_TOKEN"},params:{page:h.value,itemsPerPage:A.value,sortBy:((r=C.value[0])==null?void 0:r.key)||"createdAt",sortOrder:((a=C.value[0])==null?void 0:a.order)==="asc"?1:-1,search:M.value}});F.value.splice(0,F.value.length,...o.result.data),$.value=o.result.total}catch(o){console.log(o);const d=((e=(i=o==null?void 0:o.response)==null?void 0:i.data)==null?void 0:e.message)||"發生錯誤，請稍後再試";S({text:d,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}_.value=!1};v();const T=()=>{h.value=1,v()};return(r,a)=>{const i=G("vue-file-agent");return j(),z(pe,null,{default:t(()=>[l(K,null,{default:t(()=>[l(U,{cols:"12"},{default:t(()=>[be]),_:1}),l(U,{cols:"12"},{default:t(()=>[l(ge,{"items-per-page":A.value,"onUpdate:itemsPerPage":[a[1]||(a[1]=e=>A.value=e),v],"sort-by":C.value,"onUpdate:sortBy":[a[2]||(a[2]=e=>C.value=e),v],page:h.value,"onUpdate:page":[a[3]||(a[3]=e=>h.value=e),v],items:F.value,headers:J,loading:_.value,"items-length":$.value,search:M.value,hover:""},{top:t(()=>[l(p,{label:"搜尋","append-icon":"mdi-magnify",modelValue:M.value,"onUpdate:modelValue":a[0]||(a[0]=e=>M.value=e),"onClick:append":T,onKeydown:X(T,["enter"])},null,8,["modelValue"])]),"item.image":t(({item:e})=>[l(Z,{src:e.image,height:"60"},null,8,["src"])]),"item.pass":t(({item:e})=>[e.pass?(j(),z(ee,{key:0,icon:"mdi-check"})):ae("",!0)]),"item.edit":t(({item:e})=>[l(I,{icon:"mdi-pencil",variant:"text",color:"blue",onClick:o=>L(e)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1}),l(le,{modelValue:f.value,"onUpdate:modelValue":a[12]||(a[12]=e=>f.value=e),persistent:"",width:"600px"},{default:t(()=>[l(ve,{disabled:s(P),onSubmit:se(s(H),["prevent"])},{default:t(()=>[l(te,{class:"pa-3 ma-auto",width:"600"},{default:t(()=>[l(oe,null,{default:t(()=>[q("編輯幹員")]),_:1}),l(re,null,{default:t(()=>[l(K,{cols:"5"},{default:t(()=>[l(U,null,{default:t(()=>[l(i,{class:"ma-2",modelValue:n.value,"onUpdate:modelValue":a[4]||(a[4]=e=>n.value=e),rawModelValue:R.value,"onUpdate:rawModelValue":a[5]||(a[5]=e=>R.value=e),accept:"image/jpeg,image/png",deletable:"","error-text":{type:"檔案格式不支援",size:"檔案超過 1MB 大小限制"},"help-text":"選擇檔案或拖曳到這裡","max-files":1,"max-size":"1MB",ref_key:"fileAgent",ref:D},null,8,["modelValue","rawModelValue"])]),_:1}),l(U,{class:"d-flex justify-center align-center flex-column"},{default:t(()=>[l(p,{class:"w-100",label:"帳號",counter:"",minlength:"4",maxlength:"20",modelValue:s(V).value.value,"onUpdate:modelValue":a[6]||(a[6]=e=>s(V).value.value=e),"error-messages":s(V).errorMessage.value},null,8,["modelValue","error-messages"]),l(p,{class:"w-100",label:"幹員代號",modelValue:s(b).value.value,"onUpdate:modelValue":a[7]||(a[7]=e=>s(b).value.value=e),"error-messages":s(b).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),l(p,{label:"信箱",modelValue:s(k).value.value,"onUpdate:modelValue":a[8]||(a[8]=e=>s(k).value.value=e),"error-messages":s(k).errorMessage.value},null,8,["modelValue","error-messages"]),l(p,{label:"幹員專長",modelValue:s(y).value.value,"onUpdate:modelValue":a[9]||(a[9]=e=>s(y).value.value=e),"error-messages":s(y).errorMessage.value},null,8,["modelValue","error-messages"]),l(fe,{label:"是否通過幹員考核",modelValue:s(w).value.value,"onUpdate:modelValue":a[10]||(a[10]=e=>s(w).value.value=e),"error-messages":s(w).errorMessage.value},null,8,["modelValue","error-messages"]),l(Ve,{label:"工作經驗",modelValue:s(x).value.value,"onUpdate:modelValue":a[11]||(a[11]=e=>s(x).value.value=e),"error-messages":s(x).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),l(ue,null,{default:t(()=>[l(ne),l(I,{color:"red",disabled:s(P),onClick:N},{default:t(()=>[q("取消")]),_:1},8,["disabled"]),l(I,{color:"green",type:"submit",loading:s(P)},{default:t(()=>[q("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])]),_:1})]),_:1})}}};export{_e as default};
