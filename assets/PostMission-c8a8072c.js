import{Y as $,x as g,a0 as A,a1 as E,c as e,a3 as r,aj as N,a5 as R,ab as j,J as x,a8 as b,a7 as a,ah as I,ag as J,ak as Y,aa as z,al as G,ai as P,am as H,a9 as K,af as L}from"./index-5fdb30a4.js";import{c as O,a as y,e as F,f as Q,u as W,d as i,V as X}from"./index.esm-4c2e4fc2.js";import{V as Z}from"./VContainer-081fdd0a.js";import{V as ee}from"./VRow-75030038.js";import{V as S}from"./VCol-8836c20f.js";import{V as ae}from"./VDivider-9e522767.js";import{V as le,a as se}from"./VTextarea-dfc9369f.js";import"./VCheckboxBtn-ce21a40e.js";const re=L("h1",{class:"text-center"},"發布任務",-1),ce={__name:"PostMission",setup(oe){const{apiAuth:C}=j(),k=$(),M=g(null),n=g(!1),u=g(""),h=o=>{o?(u.value=o._id,d.value.value=o.title,m.value.value=o.reward,v.value.value=o.requiredPeople,p.value.value=o.isPublic,c.value.value=o.description):u.value="",n.value=!0},_=()=>{n.value=!1,U(),M.value.deleteFileRecord()},B=O().shape({title:y().required("請輸入任務標題"),reward:F().typeError("報酬格式錯誤").required("請輸入報酬").min(1,"報酬需大於 0"),requiredPeople:F().typeError("需求人數格式錯誤").required("請輸入需求人數").min(1,"需求人數需大於 0"),isPublic:Q(),description:y().required("請輸入任務內容")}),{handleSubmit:D,isSubmitting:w,resetForm:U}=W({validationSchema:B,initialValues:{title:"",reward:0,requiredPeople:"",isPublic:"",description:!1}}),d=i("title"),m=i("reward"),v=i("requiredPeople"),p=i("isPublic"),c=i("description"),V=g([]),T=D(async o=>{var l,s,q;if(!((l=V.value[0])!=null&&l.error)&&!(u.value===""&&V.value.length===0))try{const t=new FormData;for(const f in o)t.append(f,o[f]);V.value.length>0&&t.append("image",V.value[0].file),u.value===""?await C.post("/missions",t):await C.patch("/missions/"+u.value,t),k({text:u.value===""?"新增成功":"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),_()}catch(t){console.log(t);const f=((q=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:q.message)||"發生錯誤，請稍後再試";k({text:f,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});return(o,l)=>(A(),E(R,null,[e(Z,null,{default:r(()=>[e(ee,{class:"h-100 align-center"},{default:r(()=>[e(S,{cols:"12"},{default:r(()=>[re]),_:1}),e(ae),e(S,null,{default:r(()=>[e(x,{color:"green",onClick:l[0]||(l[0]=s=>h())},{default:r(()=>[b("新增任務")]),_:1})]),_:1})]),_:1})]),_:1}),e(N,{modelValue:n.value,"onUpdate:modelValue":l[6]||(l[6]=s=>n.value=s),persistent:"",width:"500px"},{default:r(()=>[e(X,{disabled:a(w),onSubmit:I(a(T),["prevent"])},{default:r(()=>[e(J,null,{default:r(()=>[e(Y,null,{default:r(()=>[b(z(u.value===""?"新增任務":"編輯任務"),1)]),_:1}),e(G,null,{default:r(()=>[e(P,{label:"任務標題",modelValue:a(d).value.value,"onUpdate:modelValue":l[1]||(l[1]=s=>a(d).value.value=s),"error-messages":a(d).errorMessage.value},null,8,["modelValue","error-messages"]),e(P,{label:"報酬/m",type:"number",min:"1",modelValue:a(m).value.value,"onUpdate:modelValue":l[2]||(l[2]=s=>a(m).value.value=s),"error-messages":a(m).errorMessage.value},null,8,["modelValue","error-messages"]),e(P,{label:"需求人數",type:"number",min:"1",modelValue:a(v).value.value,"onUpdate:modelValue":l[3]||(l[3]=s=>a(v).value.value=s),"error-messages":a(v).errorMessage.value},null,8,["modelValue","error-messages"]),e(le,{label:"私人",modelValue:a(p).value.value,"onUpdate:modelValue":l[4]||(l[4]=s=>a(p).value.value=s),"error-messages":a(p).errorMessage.value},null,8,["modelValue","error-messages"]),e(se,{label:"任務內容",modelValue:a(c).value.value,"onUpdate:modelValue":l[5]||(l[5]=s=>a(c).value.value=s),"error-messages":a(c).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),e(H,null,{default:r(()=>[e(K),e(x,{color:"red",disabled:a(w),onClick:_},{default:r(()=>[b("取消")]),_:1},8,["disabled"]),e(x,{color:"green",type:"submit",loading:a(w)},{default:r(()=>[b("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64))}};export{ce as default};
