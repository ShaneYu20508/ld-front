import{Y,x as u,$ as H,a0 as E,a1 as J,c as l,a3 as s,aj as W,a5 as G,ab as Q,J as w,a8 as x,ag as M,ak as X,V as Z,a2 as ee,a4 as ae,a7 as o,af as le,ae as te,al as se,aa as oe,ah as re,ai as ue,a9 as ne,ad as ie,W as de}from"./index-54e8280a.js";import{c as me,a as D,f as ce,u as pe,d as C,V as ve}from"./index.esm-33e2fde0.js";import{V as ge}from"./VContainer-22224a10.js";import{V as fe,a as T}from"./VRow-2450a831.js";import{V as Ve}from"./VDivider-50ab0508.js";import{V as be}from"./VDataTableServer-ee03fc2b.js";import{V as ye}from"./VDataTable-2214b418.js";import{V as ke}from"./VTextarea-ecef9e80.js";import"./VList-beea2cba.js";import"./ssrBoot-15bd7468.js";import"./VCheckboxBtn-1dbd4ffe.js";const we=ie("h1",{class:"text-center"},"發布任務",-1),_e={__name:"PostMissions",setup(xe){const{apiAuth:S}=Q(),B=Y(),_=u(null),p=u(!1),n=u(""),I=r=>{r?(n.value=r._id,v.value.value=r.title,g.value.value=r.reward,V.value.value=r.description,f.value.value=r.isPublic):n.value="",p.value=!0},$=()=>{p.value=!1,L(),_.value.deleteFileRecord()},N=["公開","私人"],z=me({title:D().required("請輸入任務標題"),reward:ce().typeError("任務報酬格式錯誤").required("請輸入任務報酬").min(1,"任務報酬不能小於 1"),status:D().required("請選擇任務狀態").test("is-public","請選擇任務狀態",r=>N.includes(r)),description:D().required("請輸入任務說明")}),{handleSubmit:K,isSubmitting:P,resetForm:L}=pe({validationSchema:z,initialValues:{title:"",reward:0,status:"公開",description:""}}),v=C("title"),g=C("reward"),f=C("status"),V=C("description"),d=u([]),R=u([]),O=K(async r=>{var a,i,e;if(!((a=d.value[0])!=null&&a.error)&&!(n.value===""&&d.value.length===0))try{const t=new FormData;for(const m in r)t.append(m,r[m]);d.value.length>0&&t.append("image",d.value[0].file),n.value===""?await S.post("/missions",t):await S.patch("/missions/"+n.value,t),B({text:n.value===""?"新增成功":"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),$(),F()}catch(t){console.log(t);const m=((e=(i=t==null?void 0:t.response)==null?void 0:i.data)==null?void 0:e.message)||"發生錯誤，請稍後再試";B({text:m,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),h=u(10),b=u([{key:"createdAt",order:"desc"}]),y=u(1),A=u([]),j=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"任務標題",align:"left",sortable:!0,key:"title"},{title:"任務報酬/m",align:"left",sortable:!0,key:"reward"},{title:"任務狀態",align:"left",sortable:!0,key:"status"},{title:"任務說明",align:"left",sortable:!0,key:"description"},{title:"編輯",align:"left",sortable:!1,key:"edit"}],U=u(!0),q=u(0),k=u(""),c=async()=>{var r,a,i,e;U.value=!0;try{const{data:t}=await S.get("/missions/all",{headers:{Authorization:"Bearer YOUR_ACCESS_TOKEN"},params:{page:y.value,itemsPerPage:h.value,sortBy:((r=b.value[0])==null?void 0:r.key)||"createdAt",sortOrder:((a=b.value[0])==null?void 0:a.order)==="asc"?1:-1,search:k.value}});A.value.splice(0,A.value.length,...t.result.data),q.value=t.result.total}catch(t){console.log(t);const m=((e=(i=t==null?void 0:t.response)==null?void 0:i.data)==null?void 0:e.message)||"發生錯誤，請稍後再試";B({text:m,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}U.value=!1};c();const F=()=>{y.value=1,c()};return(r,a)=>{const i=H("VueFileAgent");return E(),J(G,null,[l(ge,null,{default:s(()=>[l(fe,null,{default:s(()=>[l(T,{cols:"12"},{default:s(()=>[we]),_:1}),l(Ve),l(T,{cols:"12"},{default:s(()=>[l(w,{color:"green",onClick:a[0]||(a[0]=e=>I())},{default:s(()=>[x("新增任務")]),_:1})]),_:1}),l(T,{cols:"12"},{default:s(()=>[l(be,{"items-per-page":h.value,"onUpdate:itemsPerPage":[a[2]||(a[2]=e=>h.value=e),c],"sort-by":b.value,"onUpdate:sortBy":[a[3]||(a[3]=e=>b.value=e),c],page:y.value,"onUpdate:page":[a[4]||(a[4]=e=>y.value=e),c],items:A.value,headers:j,loading:U.value,"items-length":q.value,search:k.value,hover:""},{top:s(()=>[l(M,{label:"搜尋","append-icon":"mdi-magnify",modelValue:k.value,"onUpdate:modelValue":a[1]||(a[1]=e=>k.value=e),"onClick:append":F,onKeydown:X(F,["enter"])},null,8,["modelValue"])]),"item.image":s(({item:e})=>[l(Z,{src:e.image,height:"50px"},null,8,["src"])]),"item.sell":s(({item:e})=>[e.sell?(E(),ee(de,{key:0,icon:"mdi-check"})):ae("",!0)]),"item.edit":s(({item:e})=>[l(w,{icon:"mdi-pencil",variant:"text",color:"blue",onClick:t=>I(e)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),l(W,{modelValue:p.value,"onUpdate:modelValue":a[11]||(a[11]=e=>p.value=e),persistent:"",width:"500px"},{default:s(()=>[l(ve,{disabled:o(P),onSubmit:le(o(O),["prevent"])},{default:s(()=>[l(te,null,{default:s(()=>[l(se,null,{default:s(()=>[x(oe(n.value===""?"新增任務":"編輯任務"),1)]),_:1}),l(re,null,{default:s(()=>[l(M,{label:"任務標題",modelValue:o(v).value.value,"onUpdate:modelValue":a[5]||(a[5]=e=>o(v).value.value=e),"error-messages":o(v).errorMessage.value},null,8,["modelValue","error-messages"]),l(M,{label:"任務報酬/m",type:"number",min:"0",modelValue:o(g).value.value,"onUpdate:modelValue":a[6]||(a[6]=e=>o(g).value.value=e),"error-messages":o(g).errorMessage.value},null,8,["modelValue","error-messages"]),l(ye,{label:"任務狀態",items:N,modelValue:o(f).value.value,"onUpdate:modelValue":a[7]||(a[7]=e=>o(f).value.value=e),"error-messages":o(f).errorMessage.value},null,8,["modelValue","error-messages"]),l(ke,{label:"任務說明",modelValue:o(V).value.value,"onUpdate:modelValue":a[8]||(a[8]=e=>o(V).value.value=e),"error-messages":o(V).errorMessage.value},null,8,["modelValue","error-messages"]),l(i,{modelValue:d.value,"onUpdate:modelValue":a[9]||(a[9]=e=>d.value=e),rawModelValue:R.value,"onUpdate:rawModelValue":a[10]||(a[10]=e=>R.value=e),accept:"image/jpeg,image/png",deletable:"","error-text":{type:"檔案格式不支援",size:"檔案超過 1MB 大小限制"},"help-text":"選擇檔案或拖曳到這裡","max-files":1,"max-size":"1MB",ref_key:"fileAgent",ref:_},null,8,["modelValue","rawModelValue"])]),_:1}),l(ue,null,{default:s(()=>[l(ne),l(w,{color:"red",disabled:o(P),onClick:$},{default:s(()=>[x("取消")]),_:1},8,["disabled"]),l(w,{color:"green",type:"submit",loading:o(P)},{default:s(()=>[x("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};export{_e as default};
