import{Y as O,x as u,a0 as L,a1 as W,c as l,a3 as s,aj as Y,a5 as z,ab as G,J as C,a8 as x,ag as h,ak as Q,V as X,a2 as Z,a4 as ee,a7 as t,af as ae,ae as le,al as te,aa as se,ah as oe,ai as re,a9 as ue,ad as ie,W as ne}from"./index-41264980.js";import{c as de,a as N,f as _,e as me,u as ce,d as c,V as pe}from"./index.esm-25f6073d.js";import{V as ve}from"./VContainer-52caa049.js";import{V as ge,a as M}from"./VRow-994c10d5.js";import{V as Ve}from"./VDivider-d4f4db80.js";import{V as be}from"./VDataTableServer-e9a64849.js";import{V as fe}from"./VCheckbox-eee65d82.js";import{V as ye}from"./VTextarea-b1f2afea.js";import"./VDataTable-794c7da8.js";import"./VList-526fea96.js";import"./ssrBoot-bf8b8d12.js";import"./VCheckboxBtn-0dd4838e.js";const ke=ie("h1",{class:"text-center"},"商品管理",-1),Ie={__name:"MissionList",setup(Pe){const{apiAuth:S}=G(),B=O(),E=u(null),p=u(!1),i=u(""),I=r=>{r?(i.value=r._id,v.value.value=r.title,g.value.value=r.reward,V.value.value=r.requiredPeople,b.value.value=r.isPublic,f.value.value=r.description):i.value="",p.value=!0},T=()=>{p.value=!1,j(),E.value.deleteFileRecord()},R=de({title:N().required("請輸入任務標題"),reward:_().typeError("報酬格式錯誤").required("請輸入報酬").min(1,"報酬需大於 0"),requiredPeople:_().typeError("需求人數格式錯誤").required("請輸入需求人數").min(1,"需求人數需大於 0"),isPublic:me(),description:N().required("請輸入任務內容")}),{handleSubmit:K,isSubmitting:U,resetForm:j}=ce({validationSchema:R,initialValues:{title:"",reward:0,requiredPeople:"",isPublic:"",description:!1}}),v=c("title"),g=c("reward"),V=c("requiredPeople"),b=c("isPublic"),f=c("description"),y=u([]),H=K(async r=>{var a,e,n;if(!((a=y.value[0])!=null&&a.error)&&!(i.value===""&&y.value.length===0))try{const o=new FormData;for(const d in r)o.append(d,r[d]);y.value.length>0&&o.append("image",y.value[0].file),i.value===""?await S.post("/missions",o):await S.patch("/missions/"+i.value,o),B({text:i.value===""?"新增成功":"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),T(),D()}catch(o){console.log(o);const d=((n=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:n.message)||"發生錯誤，請稍後再試";B({text:d,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),q=u(10),k=u([{key:"createdAt",order:"desc"}]),P=u(1),F=u([1]),J=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"名稱",align:"center",sortable:!0,key:"name"},{title:"價格",align:"center",sortable:!0,key:"price"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"是否上架",align:"center",sortable:!0,key:"sell"},{title:"編輯",align:"center",sortable:!1,key:"edit"}],A=u(!0),$=u(0),w=u(""),m=async()=>{var r,a,e,n;A.value=!0;try{const{data:o}=await S.get("/missions/all",{params:{page:P.value,itemsPerPage:q.value,sortBy:((r=k.value[0])==null?void 0:r.key)||"createdAt",sortOrder:((a=k.value[0])==null?void 0:a.order)==="asc"?1:-1,search:w.value}});F.value.splice(0,F.value.length,...o.result.data),$.value=o.result.total}catch(o){console.log(o);const d=((n=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:n.message)||"發生錯誤，請稍後再試";B({text:d,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}A.value=!1};m();const D=()=>{P.value=1,m()};return(r,a)=>(L(),W(z,null,[l(ve,null,{default:s(()=>[l(ge,null,{default:s(()=>[l(M,{cols:"12"},{default:s(()=>[ke]),_:1}),l(Ve),l(M,{cols:"12"},{default:s(()=>[l(C,{color:"green",onClick:a[0]||(a[0]=e=>I())},{default:s(()=>[x("新增商品")]),_:1})]),_:1}),l(M,{cols:"12"},{default:s(()=>[l(be,{"items-per-page":q.value,"onUpdate:itemsPerPage":[a[2]||(a[2]=e=>q.value=e),m],"sort-by":k.value,"onUpdate:sortBy":[a[3]||(a[3]=e=>k.value=e),m],page:P.value,"onUpdate:page":[a[4]||(a[4]=e=>P.value=e),m],items:F.value,headers:J,loading:A.value,"items-length":$.value,search:w.value,hover:""},{top:s(()=>[l(h,{label:"搜尋","append-icon":"mdi-magnify",modelValue:w.value,"onUpdate:modelValue":a[1]||(a[1]=e=>w.value=e),"onClick:append":D,onKeydown:Q(D,["enter"])},null,8,["modelValue"])]),"item.image":s(({item:e})=>[l(X,{src:e.image,height:"50px"},null,8,["src"])]),"item.sell":s(({item:e})=>[e.sell?(L(),Z(ne,{key:0,icon:"mdi-check"})):ee("",!0)]),"item.edit":s(({item:e})=>[l(C,{icon:"mdi-pencil",variant:"text",color:"gray",onClick:n=>I(e)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),l(Y,{modelValue:p.value,"onUpdate:modelValue":a[10]||(a[10]=e=>p.value=e),persistent:"",width:"500px"},{default:s(()=>[l(pe,{disabled:t(U),onSubmit:ae(t(H),["prevent"])},{default:s(()=>[l(le,null,{default:s(()=>[l(te,null,{default:s(()=>[x(se(i.value===""?"新增任務":"編輯任務"),1)]),_:1}),l(oe,null,{default:s(()=>[l(h,{label:"任務標題",modelValue:t(v).value.value,"onUpdate:modelValue":a[5]||(a[5]=e=>t(v).value.value=e),"error-messages":t(v).errorMessage.value},null,8,["modelValue","error-messages"]),l(h,{label:"報酬/m",type:"number",min:"1",modelValue:t(g).value.value,"onUpdate:modelValue":a[6]||(a[6]=e=>t(g).value.value=e),"error-messages":t(g).errorMessage.value},null,8,["modelValue","error-messages"]),l(h,{label:"需求人數",type:"number",min:"1",modelValue:t(V).value.value,"onUpdate:modelValue":a[7]||(a[7]=e=>t(V).value.value=e),"error-messages":t(V).errorMessage.value},null,8,["modelValue","error-messages"]),l(fe,{label:"私人",modelValue:t(b).value.value,"onUpdate:modelValue":a[8]||(a[8]=e=>t(b).value.value=e),"error-messages":t(b).errorMessage.value},null,8,["modelValue","error-messages"]),l(ye,{label:"任務內容",modelValue:t(f).value.value,"onUpdate:modelValue":a[9]||(a[9]=e=>t(f).value.value=e),"error-messages":t(f).errorMessage.value},null,8,["modelValue","error-messages"])]),_:1}),l(re,null,{default:s(()=>[l(ue),l(C,{color:"red",disabled:t(U),onClick:T},{default:s(()=>[x("取消")]),_:1},8,["disabled"]),l(C,{color:"green",type:"submit",loading:t(U)},{default:s(()=>[x("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64))}};export{Ie as default};
